<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Position Closing Test</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="header-row">
        <h1>Position Closing Test</h1>
      </div>

      <section>
        <h2>Positions (Test Data)</h2>
        <table id="positions">
          <thead>
            <tr>
              <th>Market</th>
              <th>Outcome</th>
              <th>Size</th>
              <th>Avg Price</th>
              <th>Cur Price</th>
              <th>PnL %</th>
            </tr>
          </thead>
          <tbody id="positions-tbody"></tbody>
        </table>
      </section>

      <div id="debug-info" style="margin-top: 20px; padding: 10px; background: #1e2632; border-radius: 4px;">
        <h3>Debug Info</h3>
        <div id="debug-content"></div>
      </div>
    </div>

    <script>
      // Mock positions data for testing
      const mockPositions = [
        {
          market_name: "Will Bitcoin reach $100k in 2024?",
          outcome: "Yes",
          size: 100,
          avgPrice: 0.65,
          curPrice: 0.72,
          percentPnl: 10.8,
          asset: "0x1234567890abcdef1234567890abcdef12345678"
        },
        {
          market_name: "Ethereum merge success",
          outcome: "No",
          size: -50,
          avgPrice: 0.45,
          curPrice: 0.38,
          percentPnl: -15.6,
          asset: "0xabcdef1234567890abcdef1234567890abcdef12"
        },
        {
          market_name: "Tesla stock performance",
          outcome: "Above $300",
          size: 75,
          avgPrice: 0.55,
          curPrice: 0.48,
          percentPnl: -12.7,
          asset: "0x9876543210fedcba9876543210fedcba98765432"
        }
      ];

      function setRows(tbody, rows, columns) {
        tbody.innerHTML = '';
        
        for (const row of rows) {
          const tr = document.createElement('tr');
          for (const c of columns) {
            const td = document.createElement('td');
            let v = row[c];
            if (typeof v === 'number') {
              v = Math.abs(v) > 1e6 ? v.toFixed(2) : v;
            }
            td.textContent = v == null ? '' : v;
            tr.appendChild(td);
          }
          
          // No actions column in test view
          
          tbody.appendChild(tr);
        }
      }

      // No close actions in test view

      function updateDebugInfo(message) {
        const debugContent = document.getElementById('debug-content');
        const timestamp = new Date().toLocaleTimeString();
        debugContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
      }

      // Initialize the test page
      document.addEventListener('DOMContentLoaded', () => {
        // Load mock positions
        setRows(
          document.getElementById('positions-tbody'),
          mockPositions,
          ['market_name', 'outcome', 'size', 'avgPrice', 'curPrice', 'percentPnl']
        );
        
        updateDebugInfo('Test page loaded with mock positions');
      });
    </script>
  </body>
</html>
